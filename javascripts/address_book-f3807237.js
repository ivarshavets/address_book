(function(){var t,e,n,r;r={version:1,stores:[{name:"contactGroups",keyPath:"id",autoIncrement:!0,indexes:[{name:"name",keyPath:"name"}]},{name:"contacts",keyPath:"id",autoIncrement:!0,indexes:[{name:"groupId",keyPath:"groupId"},{name:"firstName",keyPath:"firstName"},{name:"lastName",keyPath:"lastName"},{keyPath:["groupId","firstName"]}]}]},e={size:104857600,mechanisms:[""+(!Modernizr.indexeddb||bowser.safari||bowser.ios?"websql":"indexeddb")]},n=new ydn.db.Storage("addressBook",r,e),t=angular.module("addressBook",[]),t.controller("DashboardController",["$scope","$log",function(t,e){var r,i,o,a;return i=function(t){return function(){return n.from("contactGroups").order("name").list().done(function(e){return t.editGroups=_.clone(e),t.filterGroups=_.clone(e),t.filterGroups.unshift({id:0,name:"All"}),t.contactGroups=_.clone(e),t.contactGroups.push({id:0,name:"Create new group"})}).fail(function(t){return e.error(t)})}}(this),o=function(r){return function(){return n.from("contacts").order("firstName").list().done(function(e){return r.contacts=angular.copy(e),t.$apply()}).fail(function(t){return e.error(t)})}}(this),r=function(e){return function(n){return a(n),t.newContact={groupId:0},e.closeAddContact()}}(this),a=function(){return function(t,r){return null==r&&(r=null),null!=r&&(t=_.extend(t,{id:r})),n.put("contacts",t).done(function(){return o()}).fail(function(t){return e.error(t)})}}(this),this.isAddContact=!1,this.openAddContact=function(t){return function(){return t.isAddContact=!0}}(this),this.closeAddContact=function(t){return function(){return t.isAddContact=!1}}(this),this.showAddContact=function(t){return function(){return t.isAddContact===!0}}(this),this.addContact=function(){return function(t){var o;return o={groupId:t.groupId,firstName:t.firstName,lastName:t.lastName,age:t.age},0===parseInt(t.groupId,10)?n.put("contactGroups",{name:t.newGroupName}).done(function(t){return i(),r(_.extend(o,{groupId:t}))}).fail(function(t){return e.error(t)}):r(o)}}(this),this.editContact=function(r){return function(i){return n.put("contacts",i).done(function(){return r.closeEditContact(i),t.$apply()}).fail(function(t){return e.error(t)})}}(this),this.deleteContact=function(){return function(t){return confirm("Are you sure?")?n.remove("contacts",t.id).done(function(){return o()}).fail(function(t){return e.error(t)}):void 0}}(this),this.filterContacts=function(r){return function(i){var o;return o=n.from("contacts"),null!=i.groupId&&0!==i.groupId&&(o=o.where("groupId","=",parseInt(i.groupId,10))),o.list().done(function(e){var n,o;return n=angular.copy(e),null!=i.firstOrLastName&&i.firstOrLastName.length>0&&(o=new RegExp(i.firstOrLastName.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i"),n=_.filter(n,function(t){return o.test(t.firstName)||o.test(t.lastName)})),r.contacts=_.sortBy(n,function(t){return t.firstName}),t.$apply()}).fail(function(t){return e.error(t)})}}(this),this.filterReset=function(){return function(){return o(),t.filterForm={groupId:0,firstOrLastName:""}}}(this),this.getGroupById=function(t){return function(e){return _.find(t.editGroups,function(t){return parseInt(t.id,10)===parseInt(e,10)})}}(this),this.editContactsFilter={},this.hideEditContact=function(t){return function(e){return!(null!=t.editContactsFilter["edit_"+e.id]&&t.editContactsFilter["edit_"+e.id]===!0)}}(this),this.openEditContact=function(t){return function(e){return t.editContactsFilter["edit_"+e.id]=!0}}(this),this.closeEditContact=function(t){return function(e){return t.editContactsFilter["edit_"+e.id]=!1}}(this),i(),o(),this}])}).call(this);